/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
  (https://github.com/101arrowz/fflate) for use in Troika text rendering. 
  Original licenses apply: 
  - fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
 Custom bundle of @unicode-font-resolver/client v0.3.2 (https://github.com/lojjic/unicode-font-resolver)
  for use in Troika text rendering. 
  Original MIT license applies
*/
'use strict';(function(E,y){"object"===typeof exports&&"undefined"!==typeof module?y(exports,require("three"),require("troika-worker-utils"),require("webgl-sdf-generator"),require("bidi-js"),require("troika-three-utils")):"function"===typeof define&&define.amd?define("exports three troika-worker-utils webgl-sdf-generator bidi-js troika-three-utils".split(" "),y):(E="undefined"!==typeof globalThis?globalThis:E||self,y(E.troika_three_text={},E.THREE,E.troika_worker_utils,E.webgl_sdf_generator,E.bidi_js,
E.troika_three_utils))})(this,function(E,y,Q,Y,S,ra){function sa(g){return g&&"object"===typeof g&&"default"in g?g:{"default":g}}function Pa(g,e,k,m,b,a,c,d,f,h,l=!0){return l?Qa(g,e,k,m,b,a,c,d,f,h).then(null,l=>{ta||(console.warn("WebGL SDF generation failed, falling back to JS",l),ta=!0);return ua(g,e,k,m,b,a,c,d,f,h)}):ua(g,e,k,m,b,a,c,d,f,h)}function va(){let g=V();for(;da.length&&5>V()-g;)da.shift()();la=da.length?setTimeout(va,0):0}function ua(g,e,k,m,b,a,c,d,f,h){let l="TroikaTextSDFGenerator_JS_"+
Ra++%4,p=wa[l];p||(p=wa[l]={workerModule:Q.defineWorkerModule({name:l,workerId:l,dependencies:[xa["default"],V],init(a,b){let c=a().javascript.generate;return function(...a){let d=b();return{textureData:c(...a),timing:b()-d}}},getTransferables(a){return[a.textureData.buffer]}}),requests:0,idleTimer:null});p.requests++;clearTimeout(p.idleTimer);return p.workerModule(g,e,k,m,b,a).then(({textureData:a,timing:b})=>{let G=V(),k=new Uint8Array(4*a.length);for(let b=0;b<a.length;b++)k[4*b+h]=a[b];ha.webglUtils.renderImageData(c,
k,d,f,g,e,1<<3-h);b+=V()-G;0===--p.requests&&(p.idleTimer=setTimeout(()=>{Q.terminateWorker(l)},2E3));return{timing:b}})}function Z(){return(self.performance||Date).now()}function ya(g,e){za=!0;g=Aa({},g);let k=Z();var {defaultFontURL:m}=P,b=[];m&&b.push({label:"default",src:Ba(m)});g.font&&b.push({label:"user",src:Ba(g.font)});g.font=b;g.text=""+g.text;g.sdfGlyphSize=g.sdfGlyphSize||P.sdfGlyphSize;if(null!=g.colorRanges){m={};for(var a in g.colorRanges)g.colorRanges.hasOwnProperty(a)&&(b=g.colorRanges[a],
"number"!==typeof b&&(b=Sa.set(b).getHex()),m[a]=b);g.colorRanges=m}Object.freeze(g);let {textureWidth:c,sdfExponent:d}=P,{sdfGlyphSize:f}=g,h=c/f*4,l=ia[f];l||(a=document.createElement("canvas"),a.width=c,a.height=256*f/h,l=ia[f]={glyphCount:0,sdfGlyphSize:f,sdfCanvas:a,sdfTexture:new y.Texture(a,void 0,void 0,void 0,y.LinearFilter,y.LinearFilter),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,Ta(l));let {sdfTexture:p,sdfCanvas:G}=l;Ua(g).then(a=>{let {glyphIds:b,glyphFontIndices:n,
fontData:u,glyphPositions:m,fontSize:t,timings:w}=a,v=[],F=new Float32Array(4*b.length),C=0,H=0;var B=Z();let J=u.map(a=>{let b=l.glyphsByFont.get(a.src);b||l.glyphsByFont.set(a.src,b=new Map);return b});b.forEach((c,d)=>{var e=n[d];let {src:h,unitsPerEm:p}=u[e];var g=J[e].get(c);if(!g){let {path:b,pathBounds:d}=a.glyphData[h][c];g=Math.max(d[2]-d[0],d[3]-d[1])/f*(P.sdfMargin*f+.5);var G=l.glyphCount++;J[e].set(c,g={path:b,atlasIndex:G,sdfViewBox:[d[0]-g,d[1]-g,d[2]+g,d[3]+g]});v.push(g)}({sdfViewBox:c}=
g);e=m[H++];G=m[H++];let k=t/p;F[C++]=e+c[0]*k;F[C++]=G+c[1]*k;F[C++]=e+c[2]*k;F[C++]=G+c[3]*k;b[d]=g.atlasIndex});w.quads=(w.quads||0)+(Z()-B);let I=Z();w.sdf={};B=G.height;let W=Math.pow(2,Math.ceil(Math.log2(Math.ceil(l.glyphCount/h)*f)));W>B&&(console.info(`Increasing SDF texture size ${B}->${W}`),Va(G,c,W),p.dispose());Promise.all(v.map(a=>Ca(a,l,g.gpuAccelerateSDF).then(({timing:b})=>{w.sdf[a.atlasIndex]=b}))).then(()=>{v.length&&!l.contextLost&&(Da(l),p.needsUpdate=!0);w.sdfTotal=Z()-I;w.total=
Z()-k;e(Object.freeze({parameters:g,sdfTexture:p,sdfGlyphSize:f,sdfExponent:d,glyphBounds:F,glyphAtlasIndices:b,glyphColors:a.glyphColors,caretPositions:a.caretPositions,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,capHeight:a.capHeight,xHeight:a.xHeight,topBaseline:a.topBaseline,blockBounds:a.blockBounds,visibleBounds:a.visibleBounds,timings:a.timings}))})});Promise.resolve().then(()=>{l.contextLost||G._warm||(ha.webgl.isSupported(G),G._warm=!0)})}
function Ca({path:g,atlasIndex:e,sdfViewBox:k},{sdfGlyphSize:m,sdfCanvas:b,contextLost:a},c){if(a)return Promise.resolve({timing:-1});let {textureWidth:d,sdfExponent:f}=P;a=Math.floor(e/4);return Pa(m,m,g,k,Math.max(k[2]-k[0],k[3]-k[1]),f,b,a%(d/m)*m,Math.floor(a/(d/m))*m,e%4,c)}function Ta(g){let e=g.sdfCanvas;e.addEventListener("webglcontextlost",e=>{console.log("Context Lost",e);e.preventDefault();g.contextLost=!0});e.addEventListener("webglcontextrestored",e=>{console.log("Context Restored",e);
g.contextLost=!1;let k=[];g.glyphsByFont.forEach(b=>{b.forEach(a=>{k.push(Ca(a,g,!0))})});Promise.all(k).then(()=>{Da(g);g.sdfTexture.needsUpdate=!0})})}function Aa(g,e){for(let k in e)e.hasOwnProperty(k)&&(g[k]=e[k]);return g}function Ba(g){ja||(ja="undefined"===typeof document?{}:document.createElement("a"));ja.href=g;return ja.href}function Da(g){if("function"!==typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let {sdfCanvas:e,sdfTexture:k}=g,{width:m,height:b}=
e;g=g.sdfCanvas.getContext("webgl");let a=k.image.data;a&&a.length===m*b*4||(a=new Uint8Array(m*b*4),k.image={width:m,height:b,data:a},k.flipY=!1,k.isDataTexture=!0);g.readPixels(0,0,m,b,g.RGBA,g.UNSIGNED_BYTE,a)}}function Wa(g){var e=Ea[g];if(!e){e=new y.PlaneGeometry(1,1,g,g);let k=e.clone(),m=e.attributes,b=k.attributes,a=new y.BufferGeometry,c=m.uv.count;for(let a=0;a<c;a++)b.position.array[3*a]*=-1,b.normal.array[3*a+2]*=-1;["position","normal","uv"].forEach(c=>{a.setAttribute(c,new y.Float32BufferAttribute([...m[c].array,
...b[c].array],m[c].itemSize))});a.setIndex([...e.index.array,...k.index.array.map(a=>a+c)]);a.translate(.5,.5,0);e=Ea[g]=a}return e}function na(g,e,k,m){let b=g.getAttribute(e);k?b&&b.array.length===k.length?(b.array.set(k),b.needsUpdate=!0):(g.setAttribute(e,new y.InstancedBufferAttribute(k,m)),delete g._maxInstanceCount,g.dispose()):b&&g.deleteAttribute(e)}function Fa(g){g=ra.createDerivedMaterial(g,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new y.Vector2},
uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new y.Vector4(0,0,0,0)},uTroikaClipRect:{value:new y.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new y.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new y.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new y.Matrix3},uTroikaUseGlyphColors:{value:!0},
uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",
customRewriter({vertexShader:e,fragmentShader:g}){let k=/\buniform\s+vec3\s+diffuse\b/;k.test(g)&&(g=g.replace(k,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),k.test(e)||(e=e.replace(ra.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:e,fragmentShader:g}}});g.transparent=!0;Object.defineProperties(g,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},
set(){}}});return g}function Ga(g){return Array.isArray(g)?g[0]:g}function Xa(g){let e=Ha.get(g);if(!e){e=[];let {caretPositions:k}=g,m,b=(a,b,f,h)=>{(!m||f<(m.top+m.bottom)/2)&&e.push(m={bottom:b,top:f,carets:[]});f>m.top&&(m.top=f);b<m.bottom&&(m.bottom=b);m.carets.push({x:a,y:b,height:f-b,charIndex:h})},a=0;for(;a<k.length;a+=4)b(k[a],k[a+2],k[a+3],a/4);b(k[a-3],k[a-2],k[a-1],a/4)}Ha.set(g,e);return e}var xa=sa(Y);S=sa(S);Y=Q.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==
typeof window&&(self.window=self),function(g){var e={parse:function(b){var a=e._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var f=[],h=0;h<d;h++){var l=a.readUint(b,c);c+=4;f.push(e._readFont(b,l))}return f}return[e._readFont(b,0)]},_readFont:function(b,a){var c=e._bin,d=a;c.readFixed(b,a);a+=4;var f=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");
d={_data:b,_offset:d};for(var l={},p=0;p<f;p++){var g=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var k=c.readUint(b,a);a+=4;var m=c.readUint(b,a);a+=4;l[g]={offset:k,length:m}}for(p=0;p<h.length;p++)a=h[p],l[a]&&(d[a.trim()]=e[a.trim()].parse(b,l[a].offset,l[a].length,d));return d},_tabOffset:function(b,a,c){var d=e._bin,f=d.readUshort(b,c+4);c+=12;for(var h=0;h<f;h++){var l=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var p=d.readUint(b,c);if(c+=4,d.readUint(b,c),c+=4,l==a)return p}return 0}};
e._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return e._bin.readShort(b,a)/16384},readInt:function(b,a){return e._bin._view(b).getInt32(a)},readInt8:function(b,a){return e._bin._view(b).getInt8(a)},readShort:function(b,a){return e._bin._view(b).getInt16(a)},readUshort:function(b,a){return e._bin._view(b).getUint16(a)},readUshorts:function(b,a,c){for(var d=[],f=0;f<c;f++)d.push(e._bin.readUshort(b,a+2*f));return d},readUint:function(b,a){return e._bin._view(b).getUint32(a)},
readUint64:function(b,a){return 4294967296*e._bin.readUint(b,a)+e._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var d="",f=0;f<c;f++)d+=String.fromCharCode(b[a+f]);return d},readUnicode:function(b,a,c){for(var d="",f=0;f<c;f++){var e=b[a++]<<8|b[a++];d+=String.fromCharCode(e)}return d},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var d=e._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):e._bin.readASCII(b,a,c)},readBytes:function(b,
a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));return d},_view:function(b){return b._dataView||(b._dataView=b.buffer?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView((new Uint8Array(b)).buffer))}};e._lctf={};e._lctf.parse=function(b,a,c,d,f){var h=e._bin;c={};d=a;h.readFixed(b,a);a+=4;var l=h.readUshort(b,a);a+=2;var p=h.readUshort(b,a);a=h.readUshort(b,a+2);return c.scriptList=e._lctf.readScriptList(b,
d+l),c.featureList=e._lctf.readFeatureList(b,d+p),c.lookupList=e._lctf.readLookupList(b,d+a,f),c};e._lctf.readLookupList=function(b,a,c){var d=e._bin,f=a,h=[],l=d.readUshort(b,a);a+=2;for(var p=0;p<l;p++){var g=d.readUshort(b,a);a+=2;g=e._lctf.readLookupTable(b,f+g,c);h.push(g)}return h};e._lctf.readLookupTable=function(b,a,c){var d=e._bin,f=a,h={tabs:[]};h.ltype=d.readUshort(b,a);a+=2;h.flag=d.readUshort(b,a);a+=2;var l=d.readUshort(b,a);a+=2;for(var p=h.ltype,g=0;g<l;g++){var k=d.readUshort(b,a);
a+=2;k=c(b,p,f+k,h);h.tabs.push(k)}return h};e._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};e._lctf.readClassDef=function(b,a){var c=e._bin,d=[],f=c.readUshort(b,a);if(a+=2,1==f){var h=c.readUshort(b,a);a+=2;var l=c.readUshort(b,a);a+=2;for(var p=0;p<l;p++)d.push(h+p),d.push(h+p),d.push(c.readUshort(b,a)),a+=2}if(2==f)for(f=c.readUshort(b,a),a+=2,p=0;p<f;p++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};e._lctf.getInterval=
function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c],e=b[c+1];if(b[c+2],d<=a&&a<=e)return c}return-1};e._lctf.readCoverage=function(b,a){var c=e._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);return a+=2,1==d.fmt&&(d.tab=c.readUshorts(b,a,f)),2==d.fmt&&(d.tab=c.readUshorts(b,a,3*f)),d};e._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=e._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};e._lctf.readFeatureList=function(b,a){var c=e._bin,d=a,
f=[],h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var p=c.readASCII(b,a,4);a+=4;var g=c.readUshort(b,a);a+=2;g=e._lctf.readFeatureTable(b,d+g);g.tag=p.trim();f.push(g)}return f};e._lctf.readFeatureTable=function(b,a){var c=e._bin,d=a,f={},h=c.readUshort(b,a);a+=2;0<h&&(f.featureParams=d+h);d=c.readUshort(b,a);a+=2;f.tab=[];for(h=0;h<d;h++)f.tab.push(c.readUshort(b,a+2*h));return f};e._lctf.readScriptList=function(b,a){var c=e._bin,d=a,f={},h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var p=c.readASCII(b,
a,4);a+=4;var g=c.readUshort(b,a);a+=2;f[p.trim()]=e._lctf.readScriptTable(b,d+g)}return f};e._lctf.readScriptTable=function(b,a){var c=e._bin,d=a,f={},h=c.readUshort(b,a);a+=2;0<h&&(f.default=e._lctf.readLangSysTable(b,d+h));h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var p=c.readASCII(b,a,4);a+=4;var g=c.readUshort(b,a);a+=2;f[p.trim()]=e._lctf.readLangSysTable(b,d+g)}return f};e._lctf.readLangSysTable=function(b,a){var c=e._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;
var f=c.readUshort(b,a);return a+=2,d.features=c.readUshorts(b,a,f),d};e.CFF={};e.CFF.parse=function(b,a,c){var d=e._bin;(b=new Uint8Array(b.buffer,a,c))[a=0];b[++a];b[++a];b[++a];a++;var f=[];a=e.CFF.readIndex(b,a,f);var h=[];for(c=0;c<f.length-1;c++)h.push(d.readASCII(b,a+f[c],f[c+1]-f[c]));a+=f[f.length-1];f=[];a=e.CFF.readIndex(b,a,f);h=[];for(c=0;c<f.length-1;c++)h.push(e.CFF.readDict(b,a+f[c],a+f[c+1]));a+=f[f.length-1];f=h[0];var l=[];a=e.CFF.readIndex(b,a,l);h=[];for(c=0;c<l.length-1;c++)h.push(d.readASCII(b,
a+l[c],l[c+1]-l[c]));if(a+=l[l.length-1],e.CFF.readSubrs(b,a,f),f.CharStrings){a=f.CharStrings;l=[];a=e.CFF.readIndex(b,a,l);var p=[];for(c=0;c<l.length-1;c++)p.push(d.readBytes(b,a+l[c],l[c+1]-l[c]));f.CharStrings=p}if(f.ROS){a=f.FDArray;l=[];a=e.CFF.readIndex(b,a,l);f.FDArray=[];for(c=0;c<l.length-1;c++)p=e.CFF.readDict(b,a+l[c],a+l[c+1]),e.CFF._readFDict(b,p,h),f.FDArray.push(p);a=f.FDSelect;f.FDSelect=[];c=b[a];if(a++,3!=c)throw c;l=d.readUshort(b,a);a+=2;for(c=0;c<l+1;c++)f.FDSelect.push(d.readUshort(b,
a),b[a+2]),a+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(b,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(b,f.charset,f.CharStrings.length)),e.CFF._readFDict(b,f,h),f};e.CFF._readFDict=function(b,a,c){var d,f;for(f in a.Private&&(d=a.Private[1],a.Private=e.CFF.readDict(b,d,d+a.Private[0]),a.Private.Subrs&&e.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(f)&&(a[f]=c[a[f]-426+35])};e.CFF.readSubrs=
function(b,a,c){var d=e._bin,f=[];a=e.CFF.readIndex(b,a,f);var h=f.length;c.Bias=1240>h?107:33900>h?1131:32768;c.Subrs=[];for(h=0;h<f.length-1;h++)c.Subrs.push(d.readBytes(b,a+f[h],f[h+1]-f[h]))};e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,
80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];e.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;
return-1};e.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:e.CFF.glyphByUnicode(b,e.CFF.tableSE[a])};e.CFF.readEncoding=function(b,a,c){e._bin;c=[".notdef"];var d=b[a];if(a++,0!=d)throw"error: unknown encoding format: "+d;d=b[a];a++;for(var f=0;f<d;f++)c.push(b[a+f]);return c};e.CFF.readCharset=function(b,a,c){var d=e._bin,f=[".notdef"],h=b[a];if(a++,0==h)for(var l=0;l<c;l++){var p=d.readUshort(b,a);a+=2;f.push(p)}else{if(1!=h&&2!=h)throw"error: format: "+h;for(;f.length<c;){p=d.readUshort(b,a);
a+=2;var g=0;1==h?(g=b[a],a++):(g=d.readUshort(b,a),a+=2);for(l=0;l<=g;l++)f.push(p),p++}}return f};e.CFF.readIndex=function(b,a,c){var d=e._bin,f=d.readUshort(b,a)+1,h=b[a+=2];if(a++,1==h)for(var l=0;l<f;l++)c.push(b[a+l]);else if(2==h)for(l=0;l<f;l++)c.push(d.readUshort(b,a+2*l));else if(3==h)for(l=0;l<f;l++)c.push(16777215&d.readUint(b,a+3*l-1));else if(1!=f)throw"unsupported offset size: "+h+", count: "+f;return a+f*h-1};e.CFF.getCharString=function(b,a,c){var d=e._bin,f=b[a],h=b[a+1];b[a+2];
b[a+3];b[a+4];var l=1,g=null,k=null;20>=f&&(g=f,l=1);12==f&&(g=100*f+h,l=2);21<=f&&27>=f&&(g=f,l=1);28==f&&(k=d.readShort(b,a+1),l=3);29<=f&&31>=f&&(g=f,l=1);32<=f&&246>=f&&(k=f-139,l=1);247<=f&&250>=f&&(k=256*(f-247)+h+108,l=2);251<=f&&254>=f&&(k=256*-(f-251)-h-108,l=2);255==f&&(k=d.readInt(b,a+1)/65535,l=5);c.val=null!=k?k:"o"+g;c.size=l};e.CFF.readCharString=function(b,a,c){c=a+c;for(var d=e._bin,f=[];a<c;){var h=b[a],l=b[a+1];b[a+2];b[a+3];b[a+4];var g=1,k=null,m=null;20>=h&&(k=h,g=1);12==h&&
(k=100*h+l,g=2);19!=h&&20!=h||(k=h,g=2);21<=h&&27>=h&&(k=h,g=1);28==h&&(m=d.readShort(b,a+1),g=3);29<=h&&31>=h&&(k=h,g=1);32<=h&&246>=h&&(m=h-139,g=1);247<=h&&250>=h&&(m=256*(h-247)+l+108,g=2);251<=h&&254>=h&&(m=256*-(h-251)-l-108,g=2);255==h&&(m=d.readInt(b,a+1)/65535,g=5);f.push(null!=m?m:"o"+k);a+=g}return f};e.CFF.readDict=function(b,a,c){for(var d=e._bin,f={},h=[];a<c;){var l=b[a],g=b[a+1];b[a+2];b[a+3];b[a+4];var k=1,m=null,x=null;if(28==l&&(x=d.readShort(b,a+1),k=3),29==l&&(x=d.readInt(b,a+
1),k=5),32<=l&&246>=l&&(x=l-139,k=1),247<=l&&250>=l&&(x=256*(l-247)+g+108,k=2),251<=l&&254>=l&&(x=256*-(l-251)-g-108,k=2),255==l)throw d.readInt(b,a+1),"unknown number";if(30==l){x=[];for(k=1;;){var n=b[a+k];k++;var r=n>>4;n&=15;if(15!=r&&x.push(r),15!=n&&x.push(n),15==n)break}r="";n=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var q=0;q<x.length;q++)r+=n[x[q]];x=parseFloat(r)}21>=l&&(m="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[l],
k=1,12==l)&&(m=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][g],k=2);null!=m?(f[m]=1==h.length?h[0]:
h,h=[]):h.push(x);a+=k}return f};e.cmap={};e.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=e._bin;var d={};c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;var h=[];d.tables=[];for(var l=0;l<f;l++){var g=c.readUshort(b,a);a+=2;var k=c.readUshort(b,a);a+=2;var m=c.readUint(b,a);a+=4;var x="p"+g+"e"+k,n=h.indexOf(m);if(-1==n){var r;n=d.tables.length;h.push(m);var q=c.readUshort(b,m);0==q?r=e.cmap.parse0(b,m):4==q?r=e.cmap.parse4(b,m):6==q?r=e.cmap.parse6(b,m):12==q?r=e.cmap.parse12(b,
m):console.debug("unknown format: "+q,g,k,m);d.tables.push(r)}if(null!=d[x])throw"multiple tables for one platform+encoding";d[x]=n}return d};e.cmap.parse0=function(b,a){var c=e._bin,d={};d.format=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<f-6;c++)d.map.push(b[a+c]);return d};e.cmap.parse4=function(b,a){var c=e._bin,d=a,f={};f.format=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var l=c.readUshort(b,a);a+=2;l/=2;f.searchRange=
c.readUshort(b,a);a+=2;f.entrySelector=c.readUshort(b,a);a+=2;f.rangeShift=c.readUshort(b,a);a+=2;f.endCount=c.readUshorts(b,a,l);a=a+2*l+2;f.startCount=c.readUshorts(b,a,l);a+=2*l;f.idDelta=[];for(var g=0;g<l;g++)f.idDelta.push(c.readShort(b,a)),a+=2;f.idRangeOffset=c.readUshorts(b,a,l);a+=2*l;for(f.glyphIdArray=[];a<d+h;)f.glyphIdArray.push(c.readUshort(b,a)),a+=2;return f};e.cmap.parse6=function(b,a){var c=e._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var h=0;h<f;h++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};e.cmap.parse12=function(b,a){var c=e._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var f=c.readUint(b,a);a+=4;d.groups=[];for(var h=0;h<f;h++){var l=a+12*h,g=c.readUint(b,l+0),k=c.readUint(b,l+4);l=c.readUint(b,l+8);d.groups.push([g,k,l])}return d};e.glyf={};e.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};e.glyf._parseGlyf=function(b,a){var c=e._bin,d=b._data,f=e._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(d,f),f+=2,b.xMin=c.readShort(d,f),f+=2,b.yMin=c.readShort(d,f),f+=2,b.xMax=c.readShort(d,f),f+=2,b.yMax=c.readShort(d,f),f+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,f)),f+=2;a=c.readUshort(d,f);if(f+=2,d.length-f<a)return null;
b.instructions=c.readBytes(d,f,a);f+=a;var h=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<h;a++){var l=d[f];if(f++,b.flags.push(l),0!=(8&l)){var g=d[f];f++;for(var k=0;k<g;k++)b.flags.push(l),a++}}b.xs=[];for(a=0;a<h;a++)l=0!=(2&b.flags[a]),g=0!=(16&b.flags[a]),l?(b.xs.push(g?d[f]:-d[f]),f++):g?b.xs.push(0):(b.xs.push(c.readShort(d,f)),f+=2);b.ys=[];for(a=0;a<h;a++)l=0!=(4&b.flags[a]),g=0!=(32&b.flags[a]),l?(b.ys.push(g?d[f]:-d[f]),f++):g?b.ys.push(0):(b.ys.push(c.readShort(d,f)),f+=2);for(a=f=d=0;a<
h;a++)d+=b.xs[a],f+=b.ys[a],b.xs[a]=d,b.ys[a]=f}else{b.parts=[];do a=c.readUshort(d,f),f+=2,h={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(h),h.glyphIndex=c.readUshort(d,f),f+=2,1&a)?(l=c.readShort(d,f),f+=2,g=c.readShort(d,f),f+=2):(l=c.readInt8(d,f),f++,g=c.readInt8(d,f),f++),2&a?(h.m.tx=l,h.m.ty=g):(h.p1=l,h.p2=g),8&a?(h.m.a=h.m.d=c.readF2dot14(d,f),f+=2):64&a?(h.m.a=c.readF2dot14(d,f),f+=2,h.m.d=c.readF2dot14(d,f),f+=2):128&a&&(h.m.a=c.readF2dot14(d,f),f+=2,h.m.b=c.readF2dot14(d,
f),f+=2,h.m.c=c.readF2dot14(d,f),f+=2,h.m.d=c.readF2dot14(d,f),f+=2);while(32&a);if(256&a)for(c=c.readUshort(d,f),f+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[f]),f++}return b};e.GPOS={};e.GPOS.parse=function(b,a,c,d){return e._lctf.parse(b,a,c,d,e.GPOS.subt)};e.GPOS.subt=function(b,a,c,d){var f=e._bin,h=c,l={};if(l.fmt=f.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=l.fmt){var g=f.readUshort(b,c);c+=2;l.coverage=e._lctf.readCoverage(b,g+h)}if(1==a&&1==l.fmt)d=f.readUshort(b,c),c+=2,e._lctf.numOfOnes(d),
0!=d&&(l.pos=e.GPOS.readValueRecord(b,c,d));else if(2==a&&1<=l.fmt&&2>=l.fmt){d=f.readUshort(b,c);c+=2;g=f.readUshort(b,c);c+=2;a=e._lctf.numOfOnes(d);var k=e._lctf.numOfOnes(g);if(1==l.fmt){l.pairsets=[];var m=f.readUshort(b,c);c+=2;for(var x=0;x<m;x++){var n=h+f.readUshort(b,c);c+=2;var r=f.readUshort(b,n);n+=2;for(var q=[],t=0;t<r;t++){var w=f.readUshort(b,n);n+=2;0!=d&&(v=e.GPOS.readValueRecord(b,n,d),n+=2*a);0!=g&&(F=e.GPOS.readValueRecord(b,n,g),n+=2*k);q.push({gid2:w,val1:v,val2:F})}l.pairsets.push(q)}}if(2==
l.fmt)for(v=f.readUshort(b,c),c+=2,F=f.readUshort(b,c),c+=2,m=f.readUshort(b,c),c+=2,f=f.readUshort(b,c),c+=2,l.classDef1=e._lctf.readClassDef(b,h+v),l.classDef2=e._lctf.readClassDef(b,h+F),l.matrix=[],x=0;x<m;x++){h=[];for(t=0;t<f;t++){var v=null,F=null;0!=d&&(v=e.GPOS.readValueRecord(b,c,d),c+=2*a);0!=g&&(F=e.GPOS.readValueRecord(b,c,g),c+=2*k);h.push({val1:v,val2:F})}l.matrix.push(h)}}else{if(9==a&&1==l.fmt){l=f.readUshort(b,c);c=f.readUint(b,c+2);if(9==d.ltype)d.ltype=l;else if(d.ltype!=l)throw"invalid extension substitution";
return e.GPOS.subt(b,d.ltype,h+c)}console.debug("unsupported GPOS table LookupType",a,"format",l.fmt)}return l};e.GPOS.readValueRecord=function(b,a,c){var d=e._bin,f=[];return f.push(1&c?d.readShort(b,a):0),a+=1&c?2:0,f.push(2&c?d.readShort(b,a):0),a+=2&c?2:0,f.push(4&c?d.readShort(b,a):0),a+=4&c?2:0,f.push(8&c?d.readShort(b,a):0),f};e.GSUB={};e.GSUB.parse=function(b,a,c,d){return e._lctf.parse(b,a,c,d,e.GSUB.subt)};e.GSUB.subt=function(b,a,c,d){var f=e._bin,h=c,l={};if(l.fmt=f.readUshort(b,c),c+=
2,1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=l.fmt||6==a&&2>=l.fmt){var g=f.readUshort(b,c);c+=2;l.coverage=e._lctf.readCoverage(b,h+g)}if(1==a&&1<=l.fmt&&2>=l.fmt)1==l.fmt?l.delta=f.readShort(b,c):2==l.fmt&&(a=f.readUshort(b,c),l.newg=f.readUshorts(b,c+2,a));else if(4==a)for(l.vals=[],a=f.readUshort(b,c),c+=2,d=0;d<a;d++)g=f.readUshort(b,c),c+=2,l.vals.push(e.GSUB.readLigatureSet(b,h+g));else if(5==a&&2==l.fmt){if(2==l.fmt)for(d=f.readUshort(b,c),c+=2,l.cDef=e._lctf.readClassDef(b,
h+d),l.scset=[],a=f.readUshort(b,c),c+=2,d=0;d<a;d++)g=f.readUshort(b,c),c+=2,l.scset.push(0==g?null:e.GSUB.readSubClassSet(b,h+g))}else if(6==a&&3==l.fmt){if(3==l.fmt){for(d=0;3>d;d++){a=f.readUshort(b,c);c+=2;g=[];for(var k=0;k<a;k++)g.push(e._lctf.readCoverage(b,h+f.readUshort(b,c+2*k)));c+=2*a;0==d&&(l.backCvg=g);1==d&&(l.inptCvg=g);2==d&&(l.ahedCvg=g)}a=f.readUshort(b,c);l.lookupRec=e.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==l.fmt){l=f.readUshort(b,c);c=f.readUint(b,c+2);if(9==
d.ltype)d.ltype=l;else if(d.ltype!=l)throw"invalid extension substitution";return e.GSUB.subt(b,d.ltype,h+c)}console.debug("unsupported GSUB table LookupType",a,"format",l.fmt)}return l};e.GSUB.readSubClassSet=function(b,a){var c=e._bin.readUshort,d=a,f=[],h=c(b,a);a+=2;for(var g=0;g<h;g++){var p=c(b,a);a+=2;f.push(e.GSUB.readSubClassRule(b,d+p))}return f};e.GSUB.readSubClassRule=function(b,a){var c=e._bin.readUshort,d={},f=c(b,a),h=c(b,a+=2);a+=2;d.input=[];for(var g=0;g<f-1;g++)d.input.push(c(b,
a)),a+=2;return d.substLookupRecords=e.GSUB.readSubstLookupRecords(b,a,h),d};e.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=e._bin.readUshort,f=[],h=0;h<c;h++)f.push(d(b,a),d(b,a+2)),a+=4;return f};e.GSUB.readChainSubClassSet=function(b,a){var c=e._bin,d=a,f=[],h=c.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var p=c.readUshort(b,a);a+=2;f.push(e.GSUB.readChainSubClassRule(b,d+p))}return f};e.GSUB.readChainSubClassRule=function(b,a){for(var c=e._bin,d={},f=["backtrack","input","lookahead"],
h=0;h<f.length;h++){var g=c.readUshort(b,a);a+=2;1==h&&g--;d[f[h]]=c.readUshorts(b,a,g);a+=2*d[f[h]].length}g=c.readUshort(b,a);return a+=2,d.subst=c.readUshorts(b,a,2*g),d};e.GSUB.readLigatureSet=function(b,a){var c=e._bin,d=a,f=[],h=c.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var p=c.readUshort(b,a);a+=2;f.push(e.GSUB.readLigature(b,d+p))}return f};e.GSUB.readLigature=function(b,a){var c=e._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;for(var h=0;h<f-1;h++)d.chain.push(c.readUshort(b,
a)),a+=2;return d};e.head={};e.head.parse=function(b,a,c){c=e._bin;var d={};return c.readFixed(b,a),a+=4,d.fontRevision=c.readFixed(b,a),a+=4,c.readUint(b,a),a+=4,c.readUint(b,a),a+=4,d.flags=c.readUshort(b,a),a+=2,d.unitsPerEm=c.readUshort(b,a),a+=2,d.created=c.readUint64(b,a),a+=8,d.modified=c.readUint64(b,a),a+=8,d.xMin=c.readShort(b,a),a+=2,d.yMin=c.readShort(b,a),a+=2,d.xMax=c.readShort(b,a),a+=2,d.yMax=c.readShort(b,a),a+=2,d.macStyle=c.readUshort(b,a),a+=2,d.lowestRecPPEM=c.readUshort(b,a),
a+=2,d.fontDirectionHint=c.readShort(b,a),a+=2,d.indexToLocFormat=c.readShort(b,a),a+=2,d.glyphDataFormat=c.readShort(b,a),d};e.hhea={};e.hhea.parse=function(b,a,c){c=e._bin;var d={};return c.readFixed(b,a),a+=4,d.ascender=c.readShort(b,a),a+=2,d.descender=c.readShort(b,a),a+=2,d.lineGap=c.readShort(b,a),a+=2,d.advanceWidthMax=c.readUshort(b,a),a+=2,d.minLeftSideBearing=c.readShort(b,a),a+=2,d.minRightSideBearing=c.readShort(b,a),a+=2,d.xMaxExtent=c.readShort(b,a),a+=2,d.caretSlopeRise=c.readShort(b,
a),a+=2,d.caretSlopeRun=c.readShort(b,a),a+=2,d.caretOffset=c.readShort(b,a),a+=2,a+=8,d.metricDataFormat=c.readShort(b,a),a+=2,d.numberOfHMetrics=c.readUshort(b,a),d};e.hmtx={};e.hmtx.parse=function(b,a,c,d){c=e._bin;for(var f={aWidth:[],lsBearing:[]},h=0,g=0,p=0;p<d.maxp.numGlyphs;p++)p<d.hhea.numberOfHMetrics&&(h=c.readUshort(b,a),a+=2,g=c.readShort(b,a),a+=2),f.aWidth.push(h),f.lsBearing.push(g);return f};e.kern={};e.kern.parse=function(b,a,c,d){var f=e._bin,h=f.readUshort(b,a);if(a+=2,1==h)return e.kern.parseV1(b,
a-2,c,d);c=f.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(h=0;h<c;h++){a+=2;f.readUshort(b,a);a+=2;var g=f.readUshort(b,a);a+=2;g>>>=8;if(0!=(g&=15))throw"unknown kern table format: "+g;a=e.kern.readFormat0(b,a,d)}return d};e.kern.parseV1=function(b,a,c,d){c=e._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var f={glyph1:[],rval:[]},h=0;h<d;h++){c.readUint(b,a);a+=4;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;g>>>=8;if(0!=(g&=15))throw"unknown kern table format: "+g;a=e.kern.readFormat0(b,
a,f)}return f};e.kern.readFormat0=function(b,a,c){var d=e._bin,f=-1,h=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var g=0;g<h;g++){var p=d.readUshort(b,a);a+=2;var k=d.readUshort(b,a);a+=2;var m=d.readShort(b,a);a+=2;p!=f&&(c.glyph1.push(p),c.rval.push({glyph2:[],vals:[]}));f=c.rval[c.rval.length-1];f.glyph2.push(k);f.vals.push(m);f=p}return a};e.loca={};e.loca.parse=function(b,a,c,d){c=e._bin;var f=[],h=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==h)for(var g=0;g<d;g++)f.push(c.readUshort(b,a+(g<<1))<<1);if(1==h)for(g=0;g<d;g++)f.push(c.readUint(b,a+(g<<2)));return f};e.maxp={};e.maxp.parse=function(b,a,c){c=e._bin;var d={},f=c.readUint(b,a);return a+=4,d.numGlyphs=c.readUshort(b,a),a+=2,65536==f&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=
2,d.maxStorage=c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),a+=2,d.maxComponentDepth=c.readUshort(b,a)),d};e.name={};e.name.parse=function(b,a,c){c=e._bin;var d={};c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var h,g="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
k=a+=2,m=0;m<f;m++){var u=c.readUshort(b,a);a+=2;var x=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var w=g[r];t=k+12*f+t;if(0==u)q=c.readUnicode(b,t,q/2);else if(3==u&&0==x)q=c.readUnicode(b,t,q/2);else if(0==x)q=c.readASCII(b,t,q);else if(1==x)q=c.readUnicode(b,t,q/2);else if(3==x)q=c.readUnicode(b,t,q/2);else{if(1!=u)throw"unknown encoding "+x+", platformID: "+u;q=c.readASCII(b,t,q);console.debug("reading unknown MAC encoding "+
x+" as ASCII")}u="p"+u+","+n.toString(16);null==d[u]&&(d[u]={});d[u][void 0!==w?w:r]=q;d[u]._lang=n}for(var v in d)if(null!=d[v].postScriptName&&1033==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName&&0==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName&&3084==d[v]._lang)return d[v];for(v in d)if(null!=d[v].postScriptName)return d[v];for(v in d){h=v;break}return console.debug("returning name table with languageID "+d[h]._lang),d[h]};e["OS/2"]={};e["OS/2"].parse=function(b,
a,c){c=e._bin.readUshort(b,a);a+=2;var d={};if(0==c)e["OS/2"].version0(b,a,d);else if(1==c)e["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)e["OS/2"].version2(b,a,d);else{if(5!=c)throw"unknown OS/2 table version: "+c;e["OS/2"].version5(b,a,d)}return d};e["OS/2"].version0=function(b,a,c){var d=e._bin;return c.xAvgCharWidth=d.readShort(b,a),a+=2,c.usWeightClass=d.readUshort(b,a),a+=2,c.usWidthClass=d.readUshort(b,a),a+=2,c.fsType=d.readUshort(b,a),a+=2,c.ySubscriptXSize=d.readShort(b,a),a+=2,c.ySubscriptYSize=
d.readShort(b,a),a+=2,c.ySubscriptXOffset=d.readShort(b,a),a+=2,c.ySubscriptYOffset=d.readShort(b,a),a+=2,c.ySuperscriptXSize=d.readShort(b,a),a+=2,c.ySuperscriptYSize=d.readShort(b,a),a+=2,c.ySuperscriptXOffset=d.readShort(b,a),a+=2,c.ySuperscriptYOffset=d.readShort(b,a),a+=2,c.yStrikeoutSize=d.readShort(b,a),a+=2,c.yStrikeoutPosition=d.readShort(b,a),a+=2,c.sFamilyClass=d.readShort(b,a),a+=2,c.panose=d.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=d.readUint(b,a),a+=4,c.ulUnicodeRange2=d.readUint(b,
a),a+=4,c.ulUnicodeRange3=d.readUint(b,a),a+=4,c.ulUnicodeRange4=d.readUint(b,a),a+=4,c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)],a+=4,c.fsSelection=d.readUshort(b,a),a+=2,c.usFirstCharIndex=d.readUshort(b,a),a+=2,c.usLastCharIndex=d.readUshort(b,a),a+=2,c.sTypoAscender=d.readShort(b,a),a+=2,c.sTypoDescender=d.readShort(b,a),a+=2,c.sTypoLineGap=d.readShort(b,a),a+=2,c.usWinAscent=d.readUshort(b,a),a+=2,c.usWinDescent=d.readUshort(b,a),a+2};e["OS/2"].version1=
function(b,a,c){var d=e._bin;return a=e["OS/2"].version0(b,a,c),c.ulCodePageRange1=d.readUint(b,a),a+=4,c.ulCodePageRange2=d.readUint(b,a),a+4};e["OS/2"].version2=function(b,a,c){var d=e._bin;return a=e["OS/2"].version1(b,a,c),c.sxHeight=d.readShort(b,a),a+=2,c.sCapHeight=d.readShort(b,a),a+=2,c.usDefault=d.readUshort(b,a),a+=2,c.usBreak=d.readUshort(b,a),a+=2,c.usMaxContext=d.readUshort(b,a),a+2};e["OS/2"].version5=function(b,a,c){var d=e._bin;return a=e["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
d.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=d.readUshort(b,a),a+2};e.post={};e.post.parse=function(b,a,c){c=e._bin;var d={};return d.version=c.readFixed(b,a),a+=4,d.italicAngle=c.readFixed(b,a),a+=4,d.underlinePosition=c.readShort(b,a),a+=2,d.underlineThickness=c.readShort(b,a),d};null==e&&(e={});null==e.U&&(e.U={});e.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";
b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:65535&(0!=b.idRangeOffset[d]?b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+
b.format;};e.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];return null==d?c:("string"==typeof d&&(d=e.SVG.toPath(d),b.SVG.entries[a]=d),d)}if(b.CFF){d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var f=b.CFF,h=b.CFF.Private;if(f.ROS){for(h=0;f.FDSelect[h+2]<=a;)h+=2;h=f.FDArray[f.FDSelect[h+1]].Private}e.U._drawCFF(b.CFF.CharStrings[a],d,f,h,c)}else b.glyf&&e.U._drawGlyf(a,b,c);return c};
e.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=e.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?e.U._simpleGlyph(d,c):e.U._compoGlyph(d,a,c))};e.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=0==c?0:b.endPts[c-1]+1,f=b.endPts[c],h=d;h<=f;h++){var g=h==d?f:h-1,k=h==f?d:h+1,m=1&b.flags[h],u=1&b.flags[g],x=1&b.flags[k],n=b.xs[h],r=b.ys[h];if(h==d)if(m){if(!u){e.U.P.moveTo(a,n,r);continue}e.U.P.moveTo(a,b.xs[g],b.ys[g])}else u?e.U.P.moveTo(a,b.xs[g],b.ys[g]):e.U.P.moveTo(a,
(b.xs[g]+n)/2,(b.ys[g]+r)/2);m?u&&e.U.P.lineTo(a,n,r):x?e.U.P.qcurveTo(a,n,r,b.xs[k],b.ys[k]):e.U.P.qcurveTo(a,n,r,(n+b.xs[k])/2,(r+b.ys[k])/2)}e.U.P.closePath(a)}};e.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var f={cmds:[],crds:[]},h=b.parts[d];e.U._drawGlyf(h.glyphIndex,a,f);h=h.m;for(var g=0;g<f.crds.length;g+=2){var k=f.crds[g],m=f.crds[g+1];c.crds.push(k*h.a+m*h.b+h.tx);c.crds.push(k*h.c+m*h.d+h.ty)}for(g=0;g<f.cmds.length;g++)c.cmds.push(f.cmds[g])}};e.U._getGlyphClass=
function(b,a){b=e._lctf.getInterval(a,b);return-1==b?0:a[b+2]};e.U.getPairAdjustment=function(b,a,c){var d=!1;if(b.GPOS){var f=b.GPOS,h=f.lookupList;f=f.featureList;for(var g=[],k=0;k<f.length;k++){var m=f[k];if("kern"==m.tag){d=!0;for(var u=0;u<m.tab.length;u++)if(!g[m.tab[u]]){g[m.tab[u]]=!0;for(var x=h[m.tab[u]],n=0;n<x.tabs.length;n++)if(null!=x.tabs[n]){var r,q=x.tabs[n];if((!q.coverage||-1!=(r=e._lctf.coverageIndex(q.coverage,a)))&&1!=x.ltype&&2==x.ltype){var t=null;if(1==q.fmt)for(q=q.pairsets[r],
k=0;k<q.length;k++)q[k].gid2==c&&(t=q[k]);else if(2==q.fmt){t=e.U._getGlyphClass(a,q.classDef1);var w=e.U._getGlyphClass(c,q.classDef2);t=q.matrix[t][w]}if(t)return b=0,t.val1&&t.val1[2]&&(b+=t.val1[2]),t.val2&&t.val2[0]&&(b+=t.val2[0]),b}}}}}}return b.kern&&!d&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=c))?b.kern.rval[a].vals[c]:0};e.U._applySubs=function(b,a,c,d){for(var f=b.length-a-1,h=0;h<c.tabs.length;h++)if(null!=c.tabs[h]){var g,k=c.tabs[h];if(!k.coverage||
-1!=(g=e._lctf.coverageIndex(k.coverage,b[a])))if(1==c.ltype)b[a],1==k.fmt?b[a]+=k.delta:b[a]=k.newg[g];else if(4==c.ltype)for(var m=k.vals[g],u=0;u<m.length;u++){var x=m[u];k=x.chain.length;if(!(k>f)){for(var n=!0,r=0,q=0;q<k;q++){for(;-1==b[a+r+(1+q)];)r++;x.chain[q]!=b[a+r+(1+q)]&&(n=!1)}if(n){b[a]=x.nglyph;for(q=0;q<k+r;q++)b[a+q+1]=-1;break}}}else if(5==c.ltype&&2==k.fmt)for(m=e._lctf.getInterval(k.cDef,b[a]),r=k.scset[k.cDef[m+2]],x=0;x<r.length;x++){u=r[x];var t=u.input;if(!(t.length>f)){n=
!0;for(q=0;q<t.length;q++){var w=e._lctf.getInterval(k.cDef,b[a+1+q]);if(-1==m&&k.cDef[w+2]!=t[q]){n=!1;break}}if(n)for(n=u.substLookupRecords,u=0;u<n.length;u+=2)n[u],n[u+1]}}else if(6==c.ltype&&3==k.fmt&&e.U._glsCovered(b,k.backCvg,a-k.backCvg.length)&&e.U._glsCovered(b,k.inptCvg,a)&&e.U._glsCovered(b,k.ahedCvg,a+k.inptCvg.length))for(n=k.lookupRec,x=0;x<n.length;x+=2)m=n[x],e.U._applySubs(b,a+m,d[n[x+1]],d)}};e.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==e._lctf.coverageIndex(a[d],
b[c+d]))return!1;return!0};e.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},f=0,h=0;h<a.length;h++){var g=a[h];if(-1!=g){for(var k=h<a.length-1&&-1!=a[h+1]?a[h+1]:0,m=e.U.glyphToPath(b,g),u=0;u<m.crds.length;u+=2)d.crds.push(m.crds[u]+f),d.crds.push(m.crds[u+1]);c&&d.cmds.push(c);for(u=0;u<m.cmds.length;u++)d.cmds.push(m.cmds[u]);c&&d.cmds.push("X");f+=b.hmtx.aWidth[g];h<a.length-1&&(f+=e.U.getPairAdjustment(b,g,k))}}return d};e.U.P={};e.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,
c)};e.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};e.U.P.curveTo=function(b,a,c,d,e,h,g){b.cmds.push("C");b.crds.push(a,c,d,e,h,g)};e.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};e.U.P.closePath=function(b){b.cmds.push("Z")};e.U._drawCFF=function(b,a,c,d,f){for(var h=a.stack,g=a.nStems,k=a.haveWidth,m=a.width,u=a.open,x=0,n=a.x,r=a.y,q=0,t=0,w=0,v=0,F=0,C=0,H=0,B=0,J=0,I=0,W={val:0,size:0};x<b.length;){e.CFF.getCharString(b,x,W);var A=W.val;if(x+=W.size,
"o1"==A||"o18"==A)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0;else if("o3"==A||"o23"==A)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0;else if("o4"==A)1<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),u&&e.U.P.closePath(f),r+=h.pop(),e.U.P.moveTo(f,n,r),u=!0;else if("o5"==A)for(;0<h.length;)n+=h.shift(),r+=h.shift(),e.U.P.lineTo(f,n,r);else if("o6"==A||"o7"==A){var K=h.length,L="o6"==A;for(A=0;A<K;A++){var D=h.shift();L?n+=D:r+=
D;L=!L;e.U.P.lineTo(f,n,r)}}else if("o8"==A||"o24"==A){K=h.length;for(L=0;L+6<=K;)q=n+h.shift(),t=r+h.shift(),w=q+h.shift(),v=t+h.shift(),n=w+h.shift(),r=v+h.shift(),e.U.P.curveTo(f,q,t,w,v,n,r),L+=6;"o24"==A&&(n+=h.shift(),r+=h.shift(),e.U.P.lineTo(f,n,r))}else{if("o11"==A)break;if("o1234"==A||"o1235"==A||"o1236"==A||"o1237"==A)"o1234"==A&&(t=r,w=(q=n+h.shift())+h.shift(),I=v=t+h.shift(),C=v,B=r,n=(H=(F=(J=w+h.shift())+h.shift())+h.shift())+h.shift(),e.U.P.curveTo(f,q,t,w,v,J,I),e.U.P.curveTo(f,
F,C,H,B,n,r)),"o1235"==A&&(q=n+h.shift(),t=r+h.shift(),w=q+h.shift(),v=t+h.shift(),J=w+h.shift(),I=v+h.shift(),F=J+h.shift(),C=I+h.shift(),H=F+h.shift(),B=C+h.shift(),n=H+h.shift(),r=B+h.shift(),h.shift(),e.U.P.curveTo(f,q,t,w,v,J,I),e.U.P.curveTo(f,F,C,H,B,n,r)),"o1236"==A&&(q=n+h.shift(),t=r+h.shift(),w=q+h.shift(),I=v=t+h.shift(),C=v,H=(F=(J=w+h.shift())+h.shift())+h.shift(),B=C+h.shift(),n=H+h.shift(),e.U.P.curveTo(f,q,t,w,v,J,I),e.U.P.curveTo(f,F,C,H,B,n,r)),"o1237"==A&&(q=n+h.shift(),t=r+h.shift(),
w=q+h.shift(),v=t+h.shift(),J=w+h.shift(),I=v+h.shift(),F=J+h.shift(),C=I+h.shift(),H=F+h.shift(),B=C+h.shift(),Math.abs(H-n)>Math.abs(B-r)?n=H+h.shift():r=B+h.shift(),e.U.P.curveTo(f,q,t,w,v,J,I),e.U.P.curveTo(f,F,C,H,B,n,r));else if("o14"==A){if(0<h.length&&!k&&(m=h.shift()+c.nominalWidthX,k=!0),4==h.length)K=h.shift(),L=h.shift(),D=h.shift(),A=h.shift(),D=e.CFF.glyphBySE(c,D),A=e.CFF.glyphBySE(c,A),e.U._drawCFF(c.CharStrings[D],a,c,d,f),a.x=K,a.y=L,e.U._drawCFF(c.CharStrings[A],a,c,d,f);u&&(e.U.P.closePath(f),
u=!1)}else if("o19"==A||"o20"==A)0!=h.length%2&&!k&&(m=h.shift()+d.nominalWidthX),g+=h.length>>1,h.length=0,k=!0,x+=g+7>>3;else if("o21"==A)2<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),r+=h.pop(),n+=h.pop(),u&&e.U.P.closePath(f),e.U.P.moveTo(f,n,r),u=!0;else if("o22"==A)1<h.length&&!k&&(m=h.shift()+d.nominalWidthX,k=!0),n+=h.pop(),u&&e.U.P.closePath(f),e.U.P.moveTo(f,n,r),u=!0;else if("o25"==A){for(;6<h.length;)n+=h.shift(),r+=h.shift(),e.U.P.lineTo(f,n,r);q=n+h.shift();t=r+h.shift();w=q+h.shift();
v=t+h.shift();n=w+h.shift();r=v+h.shift();e.U.P.curveTo(f,q,t,w,v,n,r)}else if("o26"==A)for(h.length%2&&(n+=h.shift());0<h.length;)q=n,t=r+h.shift(),n=w=q+h.shift(),r=(v=t+h.shift())+h.shift(),e.U.P.curveTo(f,q,t,w,v,n,r);else if("o27"==A)for(h.length%2&&(r+=h.shift());0<h.length;)t=r,w=(q=n+h.shift())+h.shift(),v=t+h.shift(),n=w+h.shift(),r=v,e.U.P.curveTo(f,q,t,w,v,n,r);else if("o10"==A||"o29"==A)K="o10"==A?d:c,0==h.length?console.debug("error: empty stack"):(L=h.pop(),K=K.Subrs[L+K.Bias],a.x=n,
a.y=r,a.nStems=g,a.haveWidth=k,a.width=m,a.open=u,e.U._drawCFF(K,a,c,d,f),n=a.x,r=a.y,g=a.nStems,k=a.haveWidth,m=a.width,u=a.open);else if("o30"==A||"o31"==A)for(K=h.length,A=(L=0,"o31"==A),L+=K-(K&=-3);L<K;)A?(t=r,w=(q=n+h.shift())+h.shift(),r=(v=t+h.shift())+h.shift(),5==K-L?(n=w+h.shift(),L++):n=w,A=!1):(q=n,t=r+h.shift(),w=q+h.shift(),v=t+h.shift(),n=w+h.shift(),5==K-L?(r=v+h.shift(),L++):r=v,A=!0),e.U.P.curveTo(f,q,t,w,v,n,r),L+=4;else{if("o"==(A+"").charAt(0))throw console.debug("Unknown operation: "+
A,b),A;h.push(A)}}}a.x=n;a.y=r;a.nStems=g;a.haveWidth=k;a.width=m;a.open=u};var k=e,m={Typr:k};return g.Typr=k,g.default=m,Object.defineProperty(g,"__esModule",{value:!0}),g}({}).Typr},function(){return function(g){var e=Uint8Array,k=Uint16Array,m=Uint32Array,b=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(a,b){for(var c=
new k(31),d=0;31>d;++d)c[d]=b+=1<<a[d-1];a=new m(c[30]);for(d=1;30>d;++d)for(b=c[d];b<c[d+1];++b)a[b]=b-c[d]<<5|d;return[c,a]},f=d(b,2),h=f[0];f=f[1];h[28]=258;f[258]=28;var l=d(a,0)[0],p=new k(32768);for(d=0;32768>d;++d)f=(43690&d)>>>1|(21845&d)<<1,f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,p[d]=((65280&f)>>>8|(255&f)<<8)>>>1;var G=function(a,b,c){for(var d=a.length,e=0,f=new k(b);e<d;++e)++f[a[e]-1];var h=new k(b);for(e=0;e<b;++e)h[e]=h[e-1]+f[e-1]<<1;if(c)for(c=new k(1<<b),f=15-b,
e=0;e<d;++e){if(a[e]){var g=e<<4|a[e],l=b-a[e],m=h[a[e]-1]++<<l;for(l=m|(1<<l)-1;m<=l;++m)c[p[m]>>>f]=g}}else for(c=new k(d),e=0;e<d;++e)a[e]&&(c[e]=p[h[a[e]-1]++]>>>15-a[e]);return c};f=new e(288);for(d=0;144>d;++d)f[d]=8;for(d=144;256>d;++d)f[d]=9;for(d=256;280>d;++d)f[d]=7;for(d=280;288>d;++d)f[d]=8;var u=new e(32);for(d=0;32>d;++d)u[d]=5;var x=G(f,9,1),n=G(u,5,1),r=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},q=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&
b)&c},t=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],v=function(a,b,c){b=Error(b||w[a]);if(b.code=a,Error.captureStackTrace&&Error.captureStackTrace(b,v),!c)throw b;return b},F=function(d,f,g){var p=d.length;
if(!p||g&&!g.l&&5>p)return f||new e(0);var w=!f||g,u=!g||g.i;g||(g={});f||(f=new e(3*p));var A,F=function(a){var b=f.length;a>b&&(a=new e(Math.max(2*b,a)),a.set(f),f=a)},H=g.f||0,D=g.p||0,B=g.b||0,N=g.l,C=g.d,M=g.m,y=g.n,ma=8*p;do{if(!N){g.f=H=q(d,D,1);var z=q(d,D+1,3);if(D+=3,!z){D=d[(T=((A=D)/8|0)+(7&A&&1)+4)-4]|d[T-3]<<8;z=T+D;if(z>p){u&&v(0);break}w&&F(B+D);f.set(d.subarray(T,z),B);g.b=B+=D;g.p=D=8*z;continue}if(1==z)N=x,C=n,M=9,y=5;else if(2==z){M=q(d,D,31)+257;C=q(d,D+10,15)+4;N=M+q(d,D+5,31)+
1;D+=14;y=new e(N);var O=new e(19);for(z=0;z<C;++z)O[c[z]]=q(d,D+3*z,7);D+=3*C;z=r(O);C=(1<<z)-1;var E=G(O,z,1);for(z=0;z<N;){var T;T=E[q(d,D,C)];if(D+=15&T,16>(T>>>=4))y[z++]=T;else{var fa=O=0;for(16==T?(fa=3+q(d,D,3),D+=2,O=y[z-1]):17==T?(fa=3+q(d,D,7),D+=3):18==T&&(fa=11+q(d,D,127),D+=7);fa--;)y[z++]=O}}N=y.subarray(0,M);z=y.subarray(M);M=r(N);y=r(z);N=G(N,M,1);C=G(z,y,1)}else v(1);if(D>ma){u&&v(0);break}}w&&F(B+131072);E=(1<<M)-1;fa=(1<<y)-1;for(var oa=D;;oa=D){z=(O=N[t(d,D)&E])>>>4;if((D+=15&
O)>ma){u&&v(0);break}if(O||v(2),256>z)f[B++]=z;else{if(256==z){oa=D;N=null;break}O=z-254;if(264<z){var X=b[z-=257];O=q(d,D,(1<<X)-1)+h[z];D+=X}z=C[t(d,D)&fa];X=z>>>4;z||v(3);D+=15&z;z=l[X];3<X&&(X=a[X],z+=t(d,D)&(1<<X)-1,D+=X);if(D>ma){u&&v(0);break}w&&F(B+131072);for(O=B+O;B<O;B+=4)f[B]=f[B-z],f[B+1]=f[B+1-z],f[B+2]=f[B+2-z],f[B+3]=f[B+3-z];B=O}}g.l=N;g.p=oa;g.b=B;N&&(H=1,g.m=M,g.d=C,g.n=y)}while(!H);return B==f.length?f:function(a,b,c){(null==b||0>b)&&(b=0);(null==c||c>a.length)&&(c=a.length);var d=
new (a instanceof k?k:a instanceof m?m:e)(c-b);return d.set(a.subarray(b,c)),d}(f,0,B)};d=new e(0);f="undefined"!=typeof TextDecoder&&new TextDecoder;try{f.decode(d,{stream:!0}),1}catch(C){}return g.convert_streams=function(a){function b(){var a=f.getUint16(g);return g+=2,a}function c(){var a=f.getUint32(g);return g+=4,a}function d(a){u.setUint16(v,a);v+=2}function e(a){u.setUint32(v,a);v+=4}var f=new DataView(a),g=0;c();var h=c();c();var k=b();b();c();b();b();c();c();c();c();c();for(var l=0;Math.pow(2,
l)<=k;)l++;l--;for(var m=16*Math.pow(2,l),p=16*k-m,t=12,w=[],n=0;n<k;n++)w.push({tag:c(),offset:c(),compLength:c(),origLength:c(),origChecksum:c()}),t+=16;var q,r=new Uint8Array(12+16*w.length+w.reduce(function(a,b){return a+b.origLength+4},0));n=r.buffer;var u=new DataView(n),v=0;return e(h),d(k),d(m),d(l),d(p),w.forEach(function(a){e(a.tag);e(a.origChecksum);e(t);e(a.origLength);a.outOffset=t;0!=(t+=a.origLength)%4&&(t+=4-t%4)}),w.forEach(function(b){var c=a.slice(b.offset,b.offset+b.compLength);
if(b.compLength!=b.origLength){var d=new Uint8Array(b.origLength);c=new Uint8Array(c,2);F(c,d)}else d=new Uint8Array(c);r.set(d,b.outOffset);d=0;0!=(t=b.outOffset+b.origLength)%4&&(d=4-t%4);r.set((new Uint8Array(d)).buffer,b.outOffset+b.origLength);q=t+d}),n.slice(0,q)},Object.defineProperty(g,"__esModule",{value:!0}),g}({}).convert_streams},function(g,e){function k(a){if(!f){let a={R:2,L:1,D:4,C:16,U:32,T:8};f=new Map;for(let b in d){let c=0;d[b].split(",").forEach(d=>{let [e,g]=d.split("+");e=parseInt(e,
36);g=g?parseInt(g,36):0;f.set(c+=e,a[b]);for(d=g;d--;)f.set(++c,a[b])})}}return f.get(a)||32}function m(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b.codePointAt(d);65535<e&&d++;c.push(g.U.codeToGlyph(a,e))}if(a=a.GSUB){let {lookupList:d,featureList:e}=a,f,l=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,m=[];e.forEach(a=>{if(l.test(a.tag))for(let l=0;l<a.tab.length;l++){if(m[a.tab[l]])continue;m[a.tab[l]]=!0;let p=d[a.tab[l]],t=/^(isol|init|fina|medi)$/.test(a.tag);if(t&&!f){{var e=
b;let a=new Uint8Array(e.length),c=32,d=1,g=-1;for(let b=0;b<e.length;b++){let f=e.codePointAt(b),h=k(f)|0,l=1;h&8||(c&21?h&22?(l=3,1!==d&&3!==d||a[g]++):h&33&&(2===d||4===d)&&a[g]--:c&34&&(2===d||4===d)&&a[g]--,d=a[b]=l,c=h,g=b,65535<f&&b++)}f=a}}for(e=0;e<c.length;e++)f&&t&&h[f[e]]!==a.tag||g.U._applySubs(c,e,p,d)}})}return c}function b(...a){for(let b=0;b<a.length;b++)if("number"===typeof a[b])return a[b]}function a(a){let d=Object.create(null),e=a["OS/2"],f=a.hhea,h=a.head.unitsPerEm,k=b(e&&e.sTypoAscender,
f&&f.ascender,h),l={unitsPerEm:h,ascender:k,descender:b(e&&e.sTypoDescender,f&&f.descender,0),capHeight:b(e&&e.sCapHeight,k),xHeight:b(e&&e.sxHeight,k),lineGap:b(e&&e.sTypoLineGap,f&&f.lineGap),supportsCodePoint(b){return 0<g.U.codeToGlyph(a,b)},forEachGlyph(b,e,f,h){let k=0;const t=1/l.unitsPerEm*e;let p=0,w=-1;m(a,b).forEach((l,m)=>{if(-1!==l){m=d[l];if(!m){const {cmds:b,crds:e}=g.U.glyphToPath(a,l);m="";var n=0;for(let a=0,d=b.length;a<d;a++){var q=c[b[a]];m+=b[a];for(var r=1;r<=q;r++)m+=(1<r?
",":"")+e[n++]}let f;if(e.length){n=q=Infinity;r=f=-Infinity;for(let a=0,b=e.length;a<b;a+=2){let b=e[a],c=e[a+1];b<n&&(n=b);c<q&&(q=c);b>r&&(r=b);c>f&&(f=c)}}else n=r=q=f=0;m=d[l]={index:l,advanceWidth:a.hmtx.aWidth[l],xMin:n,yMin:q,xMax:r,yMax:f,path:m,pathCommandCount:b.length}}-1!==w&&(k+=g.U.getPairAdjustment(a,w,l)*t);h.call(null,m,k,p);m.advanceWidth&&(k+=m.advanceWidth*t);f&&(k+=f*e);w=l}p+=65535<b.codePointAt(p)?2:1});return k}};return l}let c={M:2,L:2,Q:4,C:6,Z:0},d={C:"18g,ca,368,1kz",
D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},
f,h=[null,"isol","init","fina","medi"];return function(b){var c=new Uint8Array(b,0,4);c=g._bin.readASCII(c,0,4);if("wOFF"===c)b=e(b);else if("wOF2"===c)throw Error("woff2 fonts not supported");return a(g.parse(b)[0])}}],init(g,e,k){g=g();e=e();return k(g,e)}});Y=Q.defineWorkerModule({name:"FontResolver",dependencies:[function(g,e){function k(a,b){let c=b=>{console.error(`Failure loading font ${a}`,b)};try{let d=new XMLHttpRequest;d.open("get",a,!0);d.responseType="arraybuffer";d.onload=function(){if(400<=
d.status)c(Error(d.statusText));else if(0<d.status)try{let c=g(d.response);c.src=a;b(c)}catch(l){c(l)}};d.onerror=c;d.send()}catch(h){c(h)}}function m(c,d){let e=b[c];e?d(e):a[c]?a[c].push(d):(a[c]=[d],k(c,d=>{d.src=c;b[c]=d;a[c].forEach(a=>a(d));delete a[c]}))}let b=Object.create(null),a=Object.create(null);return function(a,d,{lang:f,fonts:g=[],style:k="normal",weight:p="normal"}={}){function c(){if(t.length){let b=t.map(b=>a.substring(b[0],b[1]+1)).join("\n");e.getFontsForString(b,{lang:f,style:k,
weight:p}).then(({fontUrls:a,chars:b})=>{let c=r.length,d=0;t.forEach(a=>{for(let e=0,f=a[1]-a[0];e<=f;e++)n[a[0]+e]=b[d++]+c;d++});let e=0;a.forEach((b,d)=>{m(b,b=>{r[d+c]=b;++e===a.length&&h()})})})}else h()}function h(){d({chars:n,fonts:r})}function l(a,b){for(let c=0;c<b.length;c++){let [d,e=d]=b[c];if(d<=a&&a<=e)return!0}return!1}let n=new Uint8Array(a.length),r=[];a.length||h();let q=new Map,t=[];"italic"!==k&&(k="normal");"number"!==typeof p&&(p="bold"===p?700:400);g&&!Array.isArray(g)&&(g=
[g]);g=g.slice().filter(a=>!a.lang||a.lang.test(f)).reverse();if(g.length){let d=0;(function C(e=0){for(let c=e,f=a.length;c<f;c++){e=a.codePointAt(c);if(1===d&&r[n[c-1]].supportsCodePoint(e)||/\s/.test(a[c]))n[c]=n[c-1],2===d&&(t[t.length-1][1]=c);else for(let a=n[c],f=g.length;a<=f;a++)if(a===f)(2===d?t[t.length-1]:t[t.length]=[c,c])[1]=c,d=2;else{n[c]=a;let {src:f,unicodeRange:h}=g[a];if(!h||l(e,h)){let a=b[f];if(!a){m(f,()=>{C(c)});return}if(a.supportsCodePoint(e)){let b=q.get(a);"number"!==typeof b&&
(b=r.length,r.push(a),q.set(a,b));n[c]=b;d=1;break}}}65535<e&&c+1<f&&(n[c+1]=n[c],c++,2===d&&(t[t.length-1][1]=c))}c()})()}else t.push([0,a.length-1]),c()}},Y,function(){return function(g){function e(a){let b=(a&G).toString(16),c=((a&G)+l-1).toString(16);return`codepoint-index/plane${a>>16}/${b}-${c}.json`}function k(a,b){a&=p;b=b.codePointAt(a/6|0);return b=(b||48)-48,0!=(b&1<<a%6)}function m(a,b){a.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(a=>a.split("-").map(a=>parseInt(a.trim(),
16))).forEach(([a,c=a])=>{b(a,c)})}function b(a,b){m(a,(a,c)=>{for(;a<=c;a++)b(a)})}function a(a){let c=n.get(a);return c||(c=new h,b(a.ranges,a=>c.add(a)),n.set(a,c)),c}function c(a){let b=r.get(a);return b||(b=fetch(a).then(a=>a.json()),r.set(a,b)),b}function d(a,b,c){if(a[b])a=b;else if(a[c])a=c;else a:{for(let b in a){a=b;break a}a=void 0}return a}function f(a){return q||(q=new Set,b("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",a=>{q.add(a)})),q.has(a)}class h{constructor(){this.buckets=
new Map}add(a){let b=a>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&a))}has(a){let b=this.buckets.get(a>>5);return void 0!==b&&0!=(b&1<<(31&a))}serialize(){let a=[];return this.buckets.forEach((b,c)=>{a.push(`${(+c).toString(36)}:${b.toString(36)}`)}),a.join(",")}deserialize(a){this.buckets.clear();a.split(",").forEach(a=>{a=a.split(":");this.buckets.set(parseInt(a[0],36),parseInt(a[1],36))})}}let l=Math.pow(2,8),p=l-1,G=~p,u={},x={},n=new WeakMap,r=new Map,q;return g.CodePointSet=h,g.clearCache=
function(){u={};x={}},g.getFontsForString=function(b,g={}){let {lang:h="en",category:l="sans-serif",style:m="normal",weight:p=400}=g,n=(g.dataUrl||"https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v0.3.2/packages/data").replace(/\/$/g,""),q=new Map,r=new Uint8Array(b.length),t={},w={},G=Array(b.length),y=new Map;for(g=0;g<b.length;g++){let a=b.codePointAt(g),d=e(a);G[g]=d;u[d]||y.has(d)||y.set(d,c(`${n}/${d}`).then(a=>{u[d]=a}));65535<a&&g++}return Promise.all(y.values()).then(()=>{y.clear();
for(let a=0;a<b.length;a++){let d=b.codePointAt(a),e=null,f=u[G[a]];a:for(let a in f){let b=w[a];if(void 0===b&&(b=w[a]=(new RegExp(a)).test(h)),b)for(let b in f[a])if(k(d,f[a][b])){e=b;break a}}e||(console.debug(`No font coverage for U+${d.toString(16)}`),e="latin");G[a]=e;x[e]||y.has(e)||y.set(e,c(`${n}/font-meta/${e}.json`).then(a=>{x[e]=a}));65535<d&&a++}return Promise.all(y.values())}).then(()=>{var c;let e=null;for(let w=0;w<b.length;w++){let v=b.codePointAt(w);if(e&&(f(v)||a(e).has(v)))r[w]=
r[w-1];else{e=x[G[w]];var g=t[e.id];if(!g){var {typeforms:h}=e;g=d(h,l,"sans-serif");var k=d(h[g],m,"normal");{h=null===(c=h[g])||void 0===c?void 0:c[k];var u=p;let a=u;if(!h.includes(a)){a=1/0;for(let b=0;b<h.length;b++)Math.abs(h[b]-u)<Math.abs(a-u)&&(a=h[b])}h=a}g=t[e.id]=`${n}/font-files/${e.id}/${g}.${k}.${h}.woff`}k=q.get(g);null==k&&(k=q.size,q.set(g,k));r[w]=k}65535<v&&(w++,r[w]=r[w-1])}return{fontUrls:Array.from(q.keys()),chars:r}})},Object.defineProperty(g,"__esModule",{value:!0}),g}({})}],
init(g,e,k){return g(e,k())}});let V=()=>(self.performance||Date).now(),ha=xa["default"](),ta,da=[],la=0,Qa=(...g)=>new Promise((e,k)=>{da.push(()=>{const m=V();try{ha.webgl.generateIntoCanvas(...g),e({timing:V()-m})}catch(b){k(b)}});la||(la=setTimeout(va,0))}),wa={},Ra=0,Va=ha.webglUtils.resizeWebGLCanvasWithoutClearing,P={defaultFontURL:null,sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},Sa=new y.Color,za=!1,ia=Object.create(null),ja;S=Q.defineWorkerModule({name:"Typesetter",dependencies:[function(g,
e){function k({text:a,lang:b,fonts:c,style:d,weight:e,preResolvedFonts:f},h){let k=({chars:a,fonts:b})=>{let c,d;const e=[];for(let f=0;f<a.length;f++)a[f]!==d?(d=a[f],e.push(c={start:f,end:f,fontObj:b[a[f]]})):c.end=f;h(e)};f?k(f):g(a,k,{lang:b,fonts:c,style:d,weight:e})}function m({text:g="",font:l,lang:m="en",fontSize:x=400,fontWeight:n=1,fontStyle:r="normal",letterSpacing:q=0,lineHeight:t="normal",maxWidth:w=Infinity,direction:v,textAlign:y="left",textIndent:C=0,whiteSpace:E="normal",overflowWrap:B=
"normal",anchorX:J=0,anchorY:I=0,metricsOnly:W=!1,preResolvedFonts:A=null,includeCaretPositions:K=!1,chunkedBoundsSize:L=8192,colorRanges:D=null},V){let p=c(),u={fontLoad:0,typesetting:0};-1<g.indexOf("\r")&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));x=+x;q=+q;w=+w;t=t||"normal";C=+C;k({text:g,lang:m,style:r,weight:n,fonts:"string"===typeof l?[{src:l}]:l,preResolvedFonts:A},k=>{u.fontLoad=c()-p;let l=isFinite(w),m=null,n=
null,r=null,G=null,A=null,F=null,H=null,N=null,M=0,Q=0,Y="nowrap"!==E,S=new Map,Z=c(),P=C,ca=0,R=new d,U=[R];k.forEach(a=>{let {fontObj:b}=a,{ascender:c,descender:e,unitsPerEm:k,lineGap:m,capHeight:n,xHeight:p}=b,r=S.get(b);if(!r){var u=x/k;let a="normal"===t?(c-e+m)*u:t*x,d=Math.min(a,(c-e)*u);r={index:S.size,src:b.src,fontObj:b,fontSizeMult:u,unitsPerEm:k,ascender:c*u,descender:e*u,capHeight:n*u,xHeight:p*u,lineHeight:a,baseline:-((a-(c-e)*u)/2)-c*u,caretTop:(c+e)/2*u+d/2,caretBottom:(c+e)/2*u+
d/2-d};S.set(b,r)}let {fontSizeMult:v}=r;u=g.slice(a.start,a.end+1);let y,A;b.forEachGlyph(u,x,q,(b,c,e)=>{c+=ca;e+=a.start;y=c;A=b;let k=g.charAt(e),m=b.advanceWidth*v;var n=R.count;"isEmpty"in b||(b.isWhitespace=!!k&&/[^\S\u00A0]/.test(k),b.canBreakAfter=!!k&&h.test(k),b.isEmpty=b.xMin===b.xMax||b.yMin===b.yMax||f.test(k));b.isWhitespace||b.isEmpty||Q++;if(Y&&l&&!b.isWhitespace&&c+m+P>w&&n){if(R.glyphAt(n-1).glyphObj.canBreakAfter){var p=new d;P=-c}else for(;n--;)if(0===n&&"break-word"===B){p=new d;
P=-c;break}else if(R.glyphAt(n).glyphObj.canBreakAfter){p=R.splitAt(n+1);n=p.glyphAt(0).x;P-=n;for(let a=p.count;a--;)p.glyphAt(a).x-=n;break}p&&(R.isSoftWrapped=!0,R=p,U.push(R),M=w)}p=R.glyphAt(R.count);p.glyphObj=b;p.x=c+P;p.width=m;p.charIndex=e;p.fontData=r;"\n"===k&&(R=new d,U.push(R),P=-(c+m+q*x)+C)});ca=y+A.advanceWidth*v+q*x});let aa=0;U.forEach(a=>{let b=!0;for(let d=a.count;d--;){var c=a.glyphAt(d);b&&!c.glyphObj.isWhitespace&&(a.width=c.x+c.width,a.width>M&&(M=a.width),b=!1);let {lineHeight:e,
capHeight:f,xHeight:g,baseline:h}=c.fontData;e>a.lineHeight&&(a.lineHeight=e);c=h-a.baseline;0>c&&(a.baseline+=c,a.cap+=c,a.ex+=c);a.cap=Math.max(a.cap,a.baseline+f);a.ex=Math.max(a.ex,a.baseline+g)}a.baseline-=aa;a.cap-=aa;a.ex-=aa;aa+=a.lineHeight});let ea=0,ba=0;J&&("number"===typeof J?ea=-J:"string"===typeof J&&(ea=-M*("left"===J?0:"center"===J?.5:"right"===J?1:b(J))));I&&("number"===typeof I?ba=-I:"string"===typeof I&&(ba="top"===I?0:"top-baseline"===I?-U[0].baseline:"top-cap"===I?-U[0].cap:
"top-ex"===I?-U[0].ex:"middle"===I?aa/2:"bottom"===I?aa:"bottom-baseline"===I?U[U.length-1].baseline:b(I)*aa));if(!W){let b=e.getEmbeddingLevels(g,v);m=new Uint16Array(Q);n=new Uint8Array(Q);r=new Float32Array(2*Q);G={};H=[Infinity,Infinity,-Infinity,-Infinity];N=[];K&&(F=new Float32Array(4*g.length));D&&(A=new Uint8Array(3*Q));let c=0,d=-1,f=-1,h,l;U.forEach((k,p)=>{let {count:q,width:u}=k;if(0<q){p=0;for(var t=q;t--&&k.glyphAt(t).glyphObj.isWhitespace;)p++;var w=t=0;if("center"===y)t=(M-u)/2;else if("right"===
y)t=M-u;else if("justify"===y&&k.isSoftWrapped){w=0;for(var x=q-p;x--;)k.glyphAt(x).glyphObj.isWhitespace&&w++;w=(M-u)/w}if(w||t){x=0;for(var v=0;v<q;v++){var z=k.glyphAt(v),B=z.glyphObj;z.x+=t+x;0!==w&&B.isWhitespace&&v<q-p&&(x+=w,z.width+=w)}}t=e.getReorderSegments(g,b,k.glyphAt(0).charIndex,k.glyphAt(k.count-1).charIndex);for(w=0;w<t.length;w++){let [a,b]=t[w];x=Infinity;v=-Infinity;for(z=0;z<q;z++)if(k.glyphAt(z).charIndex>=a){for(B=z;z<q;z++){var C=k.glyphAt(z);if(C.charIndex>b)break;z<q-p&&
(x=Math.min(x,C.x),v=Math.max(v,C.x+C.width))}for(;B<z;B++)C=k.glyphAt(B),C.x=v-(C.x+C.width-x);break}}let E;p=a=>E=a;for(t=0;t<q;t++){v=k.glyphAt(t);E=v.glyphObj;w=E.index;(x=b.levels[v.charIndex]&1)&&(z=e.getMirroredCharacter(g[v.charIndex]))&&v.fontData.fontObj.forEachGlyph(z,0,0,p);if(K){let {charIndex:b,fontData:c}=v;z=v.x+ea;B=v.x+v.width+ea;F[4*b]=x?B:z;F[4*b+1]=x?z:B;F[4*b+2]=k.baseline+c.caretBottom+ba;F[4*b+3]=k.baseline+c.caretTop+ba;x=b-d;1<x&&a(F,d,x);d=b}if(D)for({charIndex:x}=v;x>f;)f++,
D.hasOwnProperty(f)&&(l=D[f]);if(!E.isWhitespace&&!E.isEmpty){x=c++;let {fontSizeMult:a,src:b,index:d}=v.fontData;z=G[b]||(G[b]={});z[w]||(z[w]={path:E.path,pathBounds:[E.xMin,E.yMin,E.xMax,E.yMax]});B=v.x+ea;C=k.baseline+ba;r[2*x]=B;r[2*x+1]=C;v=B+E.xMin*a;z=C+E.yMin*a;B+=E.xMax*a;C+=E.yMax*a;v<H[0]&&(H[0]=v);z<H[1]&&(H[1]=z);B>H[2]&&(H[2]=B);C>H[3]&&(H[3]=C);0===x%L&&(h={start:x,end:x,rect:[Infinity,Infinity,-Infinity,-Infinity]},N.push(h));h.end++;let e=h.rect;v<e[0]&&(e[0]=v);z<e[1]&&(e[1]=z);
B>e[2]&&(e[2]=B);C>e[3]&&(e[3]=C);m[x]=w;n[x]=d;D&&(w=3*x,A[w]=l>>16&255,A[w+1]=l>>8&255,A[w+2]=l&255)}}}});F&&(k=g.length-d,1<k&&a(F,d,k))}let da=[];S.forEach(({index:a,src:b,unitsPerEm:c,ascender:d,descender:e,lineHeight:f,capHeight:g,xHeight:h})=>{da[a]={src:b,unitsPerEm:c,ascender:d,descender:e,lineHeight:f,capHeight:g,xHeight:h}});u.typesetting=c()-Z;V({glyphIds:m,glyphFontIndices:n,glyphPositions:r,glyphData:G,fontData:da,caretPositions:F,glyphColors:A,chunkedBounds:N,fontSize:x,topBaseline:ba+
U[0].baseline,blockBounds:[ea,ba-aa,ea+M,ba],visibleBounds:H,timings:u})})}function b(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function a(a,b,c){let d=a[4*b],e=a[4*b+2],f=a[4*b+3],g=(a[4*b+1]-d)/c;for(let h=0;h<c;h++){let c=4*(b+h);a[c]=d+g*h;a[c+1]=d+g*(h+1);a[c+2]=e;a[c+3]=f}}function c(){return(self.performance||Date).now()}function d(){this.data=[]}let f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,
h=/[^\S\u00A0]|[\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/,l=["glyphObj","x","width","charIndex","fontData"];d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/l.length)},glyphAt(a){let b=d.flyweight;b.data=this.data;b.index=a;return b},splitAt(a){let b=new d;b.data=this.data.splice(a*l.length);return b}};d.flyweight=l.reduce((a,b,c,d)=>{Object.defineProperty(a,b,{get(){return this.data[this.index*l.length+c]},set(a){this.data[this.index*
l.length+c]=a}});return a},{data:null,index:0});return{typeset:m,measure:function(a,b){m({...a,metricsOnly:!0},a=>{let [c,d,e,f]=a.blockBounds;b({width:e-c,height:f-d})})}}},Y,S["default"]],init(g,e,k){return g(e,k())}});let Ua=Q.defineWorkerModule({name:"Typesetter",dependencies:[S],init(g){return function(e){return new Promise(k=>{g.typeset(e,k)})}},getTransferables(g){const e=[];for(let k in g)g[k]&&g[k].buffer&&e.push(g[k].buffer);return e}}),Ea={};class Ia extends y.InstancedBufferGeometry{constructor(){super();
this.detail=1;this.curveRadius=0;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new y.Sphere;this.boundingBox=new y.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(g){let e=this.getIndex().count;this.setDrawRange(g===y.BackSide?e/2:0,g===y.DoubleSide?e:e/2)}set detail(g){if(g!==this._detail){this._detail=g;if("number"!==typeof g||1>g)g=1;let e=Wa(g);["position","normal","uv"].forEach(g=>{this.attributes[g]=e.attributes[g].clone()});
this.setIndex(e.getIndex().clone())}}get detail(){return this._detail}set curveRadius(g){g!==this._curveRadius&&(this._curveRadius=g,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(g,e,k,m,b){na(this,"aTroikaGlyphBounds",g,4);na(this,"aTroikaGlyphIndex",e,1);na(this,"aTroikaGlyphColor",b,3);this._blockBounds=k;this._chunkedBounds=m;this.instanceCount=e.length;this._updateBounds()}_updateBounds(){let g=this._blockBounds;if(g){let {curveRadius:m,boundingBox:b}=this;if(m){let {PI:a,
floor:c,min:d,max:f,sin:h,cos:l}=Math;var e=a/2,k=2*a;let p=Math.abs(m),y=g[0]/p,u=g[2]/p,x=c((y+e)/k)!==c((u+e)/k)?-p:d(h(y)*p,h(u)*p);e=c((y-e)/k)!==c((u-e)/k)?p:f(h(y)*p,h(u)*p);k=c((y+a)/k)!==c((u+a)/k)?2*p:f(p-l(y)*p,p-l(u)*p);b.min.set(x,g[1],0>m?-k:0);b.max.set(e,g[3],0>m?0:k)}else b.min.set(g[0],g[1],0),b.max.set(g[2],g[3],0);b.getBoundingSphere(this.boundingSphere)}}applyClipRect(g){let e=this.getAttribute("aTroikaGlyphIndex").count,k=this._chunkedBounds;if(k)for(let m=k.length;m--;){e=k[m].end;
let b=k[m].rect;if(b[1]<g.w&&b[3]>g.y&&b[0]<g.z&&b[2]>g.x)break}this.instanceCount=e}}let pa=new y.MeshBasicMaterial({color:16777215,side:y.DoubleSide,transparent:!0}),Ja=new y.Matrix4,ka=new y.Vector3,qa=new y.Vector3,ca=[],Ya=new y.Vector3,Ka=()=>{let g=new y.Mesh(new y.PlaneGeometry(1,1),pa);Ka=()=>g;return g},La=()=>{let g=new y.Mesh(new y.PlaneGeometry(1,1,32,1),pa);La=()=>g;return g},Za={type:"syncstart"},$a={type:"synccomplete"},Ma="font fontSize fontStyle fontWeight lang letterSpacing lineHeight maxWidth overflowWrap text direction textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),
ab=Ma.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Na extends y.Mesh{constructor(){super(new Ia,null);this.text="";this.curveRadius=this.anchorY=this.anchorX=0;this.direction="auto";this.font=null;this.fontSize=.1;this.fontStyle=this.fontWeight="normal";this.lang="en";this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=
this.color=this.material=null;this.outlineColor=this.outlineWidth=0;this.outlineOpacity=1;this.strokeWidth=this.outlineOffsetY=this.outlineOffsetX=this.outlineBlur=0;this.strokeColor=8421504;this.fillOpacity=this.strokeOpacity=1;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.gpuAccelerateSDF=!0;this.debugSDF=!1}sync(g){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(g):(this._isSyncing=
!0,this.dispatchEvent(Za),ya({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,
sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},e=>{this._isSyncing=!1;this._textRenderInfo=e;this.geometry.updateGlyphs(e.glyphBounds,e.glyphAtlasIndices,e.blockBounds,e.chunkedBounds,e.glyphColors);let k=this._queuedSyncs;k&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{k.forEach(e=>e&&e())}));this.dispatchEvent($a);g&&g()})))}onBeforeRender(g,e,k,m,b,a){this.sync();b.isTroikaTextMaterial&&this._prepareForRender(b);b._hadOwnSide=b.hasOwnProperty("side");this.geometry.setSide(b._actualSide=
b.side);b.side=y.FrontSide}onAfterRender(g,e,k,m,b,a){b._hadOwnSide?b.side=b._actualSide:delete b.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let g=this._derivedMaterial,e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=pa.clone());g&&g.baseMaterial===e||(g=this._derivedMaterial=Fa(e),e.addEventListener("dispose",function m(){e.removeEventListener("dispose",m);g.dispose()}));if(this.outlineWidth||this.outlineBlur||
this.outlineOffsetX||this.outlineOffsetY){let e=g._outlineMtl;e||(e=g._outlineMtl=Object.create(g,{id:{value:g.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,g.addEventListener("dispose",function b(){g.removeEventListener("dispose",b);e.dispose()}));return[e,g]}return g}set material(g){g&&g.isTroikaTextMaterial?(this._derivedMaterial=g,this._baseMaterial=g.baseMaterial):this._baseMaterial=g}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(g){this.geometry.detail=
g}get curveRadius(){return this.geometry.curveRadius}set curveRadius(g){this.geometry.curveRadius=g}get customDepthMaterial(){return Ga(this.material).getDepthMaterial()}get customDistanceMaterial(){return Ga(this.material).getDistanceMaterial()}_prepareForRender(g){var e=g.isTextOutlineMaterial,k=g.uniforms,m=this.textRenderInfo;if(m){let {sdfTexture:a,blockBounds:c}=m;k.uTroikaSDFTexture.value=a;k.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height);k.uTroikaSDFGlyphSize.value=m.sdfGlyphSize;
k.uTroikaSDFExponent.value=m.sdfExponent;k.uTroikaTotalBounds.value.fromArray(c);k.uTroikaUseGlyphColors.value=!e&&!!m.glyphColors;let d=m=0,f=0,g;let l=0,p=0;if(e){let {outlineWidth:a,outlineOffsetX:b,outlineOffsetY:c,outlineBlur:e,outlineOpacity:f}=this;m=this._parsePercent(a)||0;d=Math.max(0,this._parsePercent(e)||0);g=f;l=this._parsePercent(b)||0;p=this._parsePercent(c)||0}else{if(f=Math.max(0,this._parsePercent(this.strokeWidth)||0)){var b=this.strokeColor;k.uTroikaStrokeColor.value.set(null==
b?8421504:b);b=this.strokeOpacity;null==b&&(b=1)}g=this.fillOpacity}k.uTroikaDistanceOffset.value=m;k.uTroikaPositionOffset.value.set(l,p);k.uTroikaBlurRadius.value=d;k.uTroikaStrokeWidth.value=f;k.uTroikaStrokeOpacity.value=b;k.uTroikaFillOpacity.value=null==g?1:g;k.uTroikaCurveRadius.value=this.curveRadius||0;(m=this.clipRect)&&Array.isArray(m)&&4===m.length?k.uTroikaClipRect.value.fromArray(m):(m=100*(this.fontSize||.1),k.uTroikaClipRect.value.set(c[0]-m,c[1]-m,c[2]+m,c[3]+m));this.geometry.applyClipRect(k.uTroikaClipRect.value)}k.uTroikaSDFDebug.value=
!!this.debugSDF;g.polygonOffset=!!this.depthOffset;g.polygonOffsetFactor=g.polygonOffsetUnits=this.depthOffset||0;e=e?this.outlineColor||0:this.color;null==e?delete g.color:(m=g.hasOwnProperty("color")?g.color:g.color=new y.Color,(e!==m._input||"object"===typeof e)&&m.set(m._input=e));e=this.orientation||"+x+y";if(e!==g._orientation){k=k.uTroikaOrient.value;e=e.replace(/[^-+xyz]/g,"");if(m="+x+y"!==e&&e.match(/^([-+])([xyz])([-+])([xyz])$/)){let [,a,b,d,e]=m;ka.set(0,0,0)[b]="-"===a?1:-1;qa.set(0,
0,0)[e]="-"===d?-1:1;Ja.lookAt(Ya,ka.cross(qa),qa);k.setFromMatrix4(Ja)}else k.identity();g._orientation=e}}_parsePercent(g){"string"===typeof g&&(g=(g=g.match(/^(-?[\d.]+)%$/))?parseFloat(g[1]):NaN,g=(isNaN(g)?0:g/100)*this.fontSize);return g}localPositionToTextCoords(g,e=new y.Vector2){e.copy(g);let k=this.curveRadius;k&&(e.x=Math.atan2(g.x,Math.abs(k)-Math.abs(g.z))*Math.abs(k));return e}worldPositionToTextCoords(g,e=new y.Vector2){ka.copy(g);return this.localPositionToTextCoords(this.worldToLocal(ka),
e)}raycast(g,e){let {textRenderInfo:k,curveRadius:m}=this;if(k){let b=k.blockBounds,a=m?La():Ka(),c=a.geometry,{position:d,uv:f}=c.attributes;for(let a=0;a<f.count;a++){let c=b[0]+f.getX(a)*(b[2]-b[0]),e=b[1]+f.getY(a)*(b[3]-b[1]),g=0;m&&(g=m-Math.cos(c/m)*m,c=Math.sin(c/m)*m);d.setXYZ(a,c,e,g)}c.boundingSphere=this.geometry.boundingSphere;c.boundingBox=this.geometry.boundingBox;a.matrixWorld=this.matrixWorld;a.material.side=this.material.side;ca.length=0;a.raycast(g,ca);for(g=0;g<ca.length;g++)ca[g].object=
this,e.push(ca[g])}}copy(g){let e=this.geometry;super.copy(g);this.geometry=e;ab.forEach(e=>{this[e]=g[e]});return this}clone(){return(new this.constructor).copy(this)}}Ma.forEach(g=>{let e="_private_"+g;Object.defineProperty(Na.prototype,g,{get(){return this[e]},set(g){g!==this[e]&&(this[e]=g,this._needsSync=!0)}})});let Oa=new WeakMap,Ha=new WeakMap;E.GlyphsGeometry=Ia;E.Text=Na;E.configureTextBuilder=function(g){za?console.warn("configureTextBuilder called after first font request; will be ignored."):
Aa(P,g)};E.createTextDerivedMaterial=Fa;E.dumpSDFTextures=function(){Object.keys(ia).forEach(g=>{g=ia[g].sdfCanvas;let {width:e,height:k}=g;console.log("%c.",`
      background: url(${g.toDataURL()});
      background-size: ${e}px ${k}px;
      color: transparent;
      font-size: 0;
      line-height: ${k}px;
      padding-left: ${e}px;
    `)})};E.fontResolverWorkerModule=Y;E.getCaretAtPoint=function(g,e,k){let m=null,b=null;Xa(g).forEach(a=>{if(!b||Math.abs(k-(a.top+a.bottom)/2)<Math.abs(k-(b.top+b.bottom)/2))b=a});b.carets.forEach(a=>{if(!m||Math.abs(e-a.x)<Math.abs(e-m.x))m=a});return m};E.getSelectionRects=function(g,e,k){var m;if(g){if((m=Oa.get(g))&&m.start===e&&m.end===k)return m.rects;var {caretPositions:b}=g;k<e&&(m=e,e=k,k=m);e=Math.max(e,0);k=Math.min(k,b.length+1);m=[];var a=null;for(var c=e;c<k;c++){var d=b[4*c],f=
b[4*c+1];let e=Math.min(d,f);d=Math.max(d,f);f=b[4*c+2];let g=b[4*c+3];if(!a||f!==a.bottom||g!==a.top||e>a.right||d<a.left)a={left:Infinity,right:-Infinity,bottom:f,top:g},m.push(a);a.left=Math.min(e,a.left);a.right=Math.max(d,a.right)}m.sort((a,b)=>b.bottom-a.bottom||a.left-b.left);for(b=m.length-1;0<b--;)a=m[b],c=m[b+1],a.bottom===c.bottom&&a.top===c.top&&a.left<=c.right&&a.right>=c.left&&(c.left=Math.min(c.left,a.left),c.right=Math.max(c.right,a.right),m.splice(b,1));Oa.set(g,{start:e,end:k,rects:m})}return m};
E.preloadFont=function({font:g,characters:e,sdfGlyphSize:k},m){e=Array.isArray(e)?e.join("\n"):""+e;ya({font:g,sdfGlyphSize:k,text:e},m)};E.typesetterWorkerModule=S;Object.defineProperty(E,"__esModule",{value:!0})})
